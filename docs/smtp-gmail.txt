Para configurar o **Gmail** como servidor SMTP no **Zammad**, siga estas instru√ß√µes:

---

### **Configura√ß√£o do SMTP do Gmail**
Preencha os campos da tela conforme abaixo:

- **Servidor (SMTP Host):** `smtp.gmail.com`
- **Usu√°rio:** Seu e-mail do Gmail (`nomeusuario@gmail.com`)
- **Senha:** **App Password do Google** (veja instru√ß√µes abaixo)
- **Porta:**  
  - `465` se usar **SSL**
  - `587` se usar **TLS**
- **Verifica√ß√£o SSL:**  
  - `Sim` para `465` (SSL)
  - `STARTTLS` para `587`

**Nota:**
- **Sempre use uma "Senha de Aplicativo" do Google** para evitar bloqueios de login.

---

### **üìå Qual Porta Usar?**
- **Use porta 587 com STARTTLS**.
- **Evite porta 465** (ainda funciona, mas est√° obsoleta e menos flex√≠vel).

| Porta | Protocolo | Seguran√ßa | Recomendado? |
|-------|----------|-----------|--------------|
| **465** | SSL | Conex√£o segura, mas obsoleta |  N√£o recomendado |
| **587** | STARTTLS | Padr√£o moderno para envio seguro | **Sim, recomendado** |

**Porta 587 com STARTTLS** √© o **m√©todo recomendado pelo Google**, pois permite criptografia mais flex√≠vel e √© o padr√£o para envio de e-mails via SMTP.

- **SSL** √© mais seguro, mas **alguns provedores bloqueiam a porta 465**.
- **TLS** √© mais comum e **funciona na maioria dos casos**.

---

### **Importante: Gmail exige senha de aplicativo**
Se a autentica√ß√£o com sua senha normal n√£o funcionar, voc√™ precisa gerar uma **Senha de Aplicativo** no Google. O Google bloqueia autentica√ß√£o direta com e-mail/senha por motivos de seguran√ßa.

#### 1. Acesse [Minha Conta Google](https://myaccount.google.com/security).

#### 2. Role at√© **"Como voc√™ faz login no Google"**
Se a op√ß√£o **"Senhas de app"** n√£o est√° aparecendo na se√ß√£o **"Como voc√™ faz login no Google"**. Isso acontece porque o Google **s√≥ exibe essa op√ß√£o se a verifica√ß√£o em duas etapas estiver ativada e configurada corretamente**.

1. **Ative a verifica√ß√£o em duas etapas** (se j√° estiver ativa, pule para o pr√≥ximo passo):
   - V√° para [Minha Conta Google ‚Äì Seguran√ßa](https://myaccount.google.com/security).
   - Em **"Verifica√ß√£o em duas etapas"**, clique e siga as instru√ß√µes para ativar.

**Nota:**
- Se voc√™ configurou a verifica√ß√£o em duas etapas, mas n√£o encontra a op√ß√£o para adicionar uma senha de app, pode ser porque:
   - **Voc√™ est√° usando apenas chaves de seguran√ßa** ou **Google Authenticator**.
     - Acesse [Verifica√ß√£o em duas etapas](https://myaccount.google.com/signinoptions/two-step-verification?flow=sk&opendialog=addsk).
     - Na lista de "Segundas etapas", verifique se existe a op√ß√£o "Adicionar uma chave de seguran√ßa", se sim, clique nela.
       - Clique no bot√£o "Criar uma chave de acesso" e siga as instru√ß√µes.

- O Google **n√£o exibe a op√ß√£o "Senhas de app"** se voc√™ estiver usando apenas **chaves de seguran√ßa** ou **Google Authenticator**. Se desejar, voc√™ pode ativar a op√ß√£o "SMS" ou "Solicita√ß√£o do Google"** como m√©todo principal na verifica√ß√£o em duas etapas.

2. **Gere a Senha de Aplicativo"**:
   - Acesse [Verifica√ß√£o em duas etapas](https://myaccount.google.com/signinoptions/two-step-verification?flow=sk&opendialog=addsk).
   - Clique em [Senhas de app](https://myaccount.google.com/apppasswords).
   - Informe o nome do app: **"Zammad"**.
   - Clique em **Criar** e copie a senha gerada para usar no Zammad. **fxtf kcnu csxm ycnz**
   - Copie a senha gerada e use no **campo de senha do SMTP no Zammad**

---

### **üìå O que fazer se "Senhas de app" continuar n√£o aparecendo?**
- **Confirme que a verifica√ß√£o em duas etapas est√° ativa e configurada corretamente**.
- Opcionalmente, use "SMS" ou "Solicita√ß√£o do Google" como m√©todo principal**, em vez de **chaves de seguran√ßa**.
- **Tente acessar diretamente o link:** [https://myaccount.google.com/apppasswords](https://myaccount.google.com/apppasswords).

---

### **Resumo das Configura√ß√µes para Gmail**
| Configura√ß√£o  | Valor |
|--------------|-------|
| **Servidor SMTP** | `smtp.gmail.com` |
| **Usu√°rio** | Seu e-mail do Gmail |
| **Senha** | Senha de Aplicativo do Google |
| **Porta** | ``587` (TLS) |
| **Verifica√ß√£o SSL** | `STARTTLS`|

Se o Zammad n√£o permitir selecionar STARTTLS, tente marcar a op√ß√£o **"Sim"** na verifica√ß√£o SSL.

---

### **Testando o Envio**
Ap√≥s configurar, clique em **"Continuar"** e **envie um e-mail de teste** no Zammad. Se houver erro, revise:
- Se o **servidor SMTP est√° correto**.
- Se a **senha usada √© a Senha de Aplicativo**, e n√£o sua senha normal.
- Se a **porta est√° correta** (465 SSL ou 587 TLS).

---
## Poss√≠veis erros:

### **Erro: `Mail::AddressList can not parse |Zammad Helpdesk <noreply@localhost:8080>|`**

```
Mail::AddressList can not parse |Zammad Helpdesk <noreply@localhost:8080>|
Only able to parse up to "Zammad Helpdesk <noreply@localhost>"
```

Indica que o **endere√ßo de e-mail configurado como remetente no Zammad est√° incorreto**.

---

### **Causa do Problema**
O Zammad est√° tentando enviar e-mails usando um remetente inv√°lido:
**`noreply@localhost:8080`**
O Gmail (ou qualquer outro provedor SMTP) **n√£o aceita dom√≠nios inv√°lidos** (`localhost` n√£o √© um dom√≠nio v√°lido para envio de e-mails).

---

### **Como Resolver pelo aplicativo do Zammad**
√â necess√°rio alterar o **e-mail do remetente** para um endere√ßo v√°lido. Siga os passos:

#### **1. Ajustar o remetente no Zammad**
1. V√° para **Administra√ß√£o** ‚Üí **Configura√ß√µes de Notifica√ß√£o de E-mail**.
2. Verifique o campo **"Endere√ßo de resposta padr√£o"**.
3. **Altere para um e-mail v√°lido**, por exemplo:
   ```
   Zammad Helpdesk <noreply@meusite.com>
   ```
   ou
   ```
   Zammad Support <suporte@meudominio.com.br>
   ```
4. Salve as configura√ß√µes e tente novamente.

---

#### **2Ô∏è. Ajustar nas configura√ß√µes do e-mail**
1. V√° para **Administra√ß√£o** ‚Üí **Canais** ‚Üí **E-mail**.
2. Clique no endere√ßo configurado e **verifique se o campo "De" (From) est√° correto**.
3. **Troque `noreply@localhost:8080` por um e-mail v√°lido** associado √† sua conta do Gmail.
1. V√° para **Administra√ß√£o** ‚Üí **Canais** ‚Üí **E-mail**.
2. Em "Notifica√ß√£o de email", clique no bot√£o editar.
    - Selecione "SMTP" par definir suas pr√≥prias configura√ß√µes
    - Informe:
        - **Servidor (SMTP Host):** `smtp.gmail.com`
        - **Usu√°rio:** Seu e-mail do Gmail
        - **Senha:** Senha de Aplicativo do Google `fxtf kcnu csxm ycnz`
        - **Porta:** `587` (STARTTLS)
        - **Verifica√ß√£o SSL:** `STARTTLS` (ou `Sim`)

---

#### **3. Testar o Envio**
Ap√≥s ajustar o e-mail do remetente, clique em **"Continuar"** e teste o envio.

---

#### **Conclus√£o**
- O erro acontece porque o remetente est√° configurado como `noreply@localhost:8080`, o que n√£o √© aceito por servidores SMTP.
- Alterar o remetente para um e-mail v√°lido (`noreply@meusite.com`) resolve o problema.
- Depois de corrigir, tente enviar o e-mail novamente e verifique se h√° novos erros nos logs do Zammad.


### Configurar o E-mail do Remetente no Container do Zammad
Defini√ß√£o do **e-mail do remetente (From)** nas configura√ß√µes do cont√™iner do **Zammad** usando vari√°veis de ambiente no `docker-compose.yml`.

Isso garante que o endere√ßo correto seja usado, evitando o erro `noreply@localhost:8080`.

---

#### **Como Configurar o E-mail do Remetente no Container do Zammad**
No arquivo `.env`, adicione as seguintes vari√°veis

```
# Configura√ß√µes do remetente para o ambiente de desenvolvimento
EMAIL_FROM=jailtoncarlos@gmail.com
EMAIL_REPLY_TO=jailtoncarlos@gmail.com
EMAIL_DELIVERY_METHOD=smtp

# Configura√ß√µes SMTP do Gmail
SMTP_ADDRESS=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=jailtoncarlos@gmail.com
SMTP_PASSWORD=senha_de_aplicativo
SMTP_DOMAIN=gmail.com
SMTP_AUTHENTICATION=login
SMTP_ENABLE_STARTTLS_AUTO=true
```

Nos arquivos docker-compose-dev.yml e docker-compose-prod.yml configure o servi√ßo `zammad-railsserver`:

```yaml
  zammad-railsserver:
    environment:
      - EMAIL_FROM=${EMAIL_FROM}
      - EMAIL_REPLY_TO=${EMAIL_REPLY_TO}
      - EMAIL_DELIVERY_METHOD=${EMAIL_DELIVERY_METHOD}
      - SMTP_ADDRESS=${SMTP_ADDRESS}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_DOMAIN=${SMTP_DOMAIN}
      - SMTP_AUTHENTICATION=${SMTP_AUTHENTICATION}
      - SMTP_ENABLE_STARTTLS_AUTO=${SMTP_ENABLE_STARTTLS_AUTO}
    env_file:
      - .env
```

**Explica√ß√£o das vari√°veis**:
- **EMAIL_FROM** ‚Üí Define o e-mail do remetente (corrige o problema do `noreply@localhost`).
- **EMAIL_REPLY_TO** ‚Üí Define o e-mail para respostas dos clientes.
- **EMAIL_DELIVERY_METHOD** ‚Üí Define o envio via **SMTP**.
- **SMTP_ADDRESS** ‚Üí Servidor SMTP do Gmail (`smtp.gmail.com`).
- **SMTP_PORT** ‚Üí `587` (STARTTLS) ou `465` (SSL).
- **SMTP_USER** ‚Üí Seu e-mail do Gmail.
- **SMTP_PASSWORD** ‚Üí **Use a senha de aplicativo do Google, nunca sua senha normal**.
- **SMTP_DOMAIN** ‚Üí O dom√≠nio que ser√° usado no remetente (`meusite.com`).
- **SMTP_AUTHENTICATION** ‚Üí Define o m√©todo de autentica√ß√£o como `login`.
- **SMTP_ENABLE_STARTTLS_AUTO** ‚Üí Ativa criptografia STARTTLS automaticamente.

---

#### **Aplicando as Configura√ß√µes**
1. **Reinicie os containers do Zammad** para aplicar as configura√ß√µes:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

2. **Verifique se as configura√ß√µes foram aplicadas**:
   ```bash
   docker exec -it zammad-railsserver env | grep EMAIL
   ```

3. **Teste o envio de e-mails no Zammad**:
   - Acesse **Administra√ß√£o** ‚Üí **Configura√ß√µes de Notifica√ß√£o de E-mail**.
   - Verifique se o remetente est√° correto.
   - Envie um e-mail de teste.

---

#### **‚úÖ Conclus√£o**
- Agora, o Zammad usar√° **`suporte@meusite.com`** como remetente em vez de `noreply@localhost`.
- Todas as configura√ß√µes do SMTP foram movidas para o **docker-compose.yml**, evitando configura√ß√µes manuais na interface web.
- O Gmail exigir√° uma **Senha de Aplicativo**, ent√£o **n√£o use sua senha normal**.
